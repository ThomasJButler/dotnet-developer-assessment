@model DeveloperAssessment.Web.Models.Comment

@* recursive partial view for comments - displays comment & any nested replies *@
@* uses media object structure with avatar, reply button & nested reply forms *@

<div class="media mb-4">
    <img class="d-flex mr-3 rounded-circle comment-avatar"
         src="https://eu.ui-avatars.com/api/?name=@Uri.EscapeDataString(Model.Name)"
         alt="@Model.Name"
         style="width: 50px; height: 50px;">

    <div class="media-body">
        <h5 class="comment-author">@Model.Name <small class="comment-date">(@Model.Date.ToString("MMMM d, yyyy - HH:mm"))</small></h5>
        <div class="comment-text">@Model.Message</div>

        <!-- reply button - triggers javascript to show/hide reply form -->
        <button class="btn btn-reply" onclick="toggleReply('@Model.Name')">Reply</button>

        <!-- reply form (hidden by default) - allows nested comment submission -->
        <div id="reply-@Model.Name.Replace(" ", "")" class="reply-form" style="display:none;">
            <form asp-action="AddReply" asp-route-id="@ViewContext.RouteData.Values["id"]" method="post">
                <input type="hidden" name="parentName" value="@Model.Name" />
                <div class="form-group">
                    <input name="Name" class="form-control form-control-sm" placeholder="Your name" required />
                </div>
                <div class="form-group">
                    <input name="EmailAddress" type="email" class="form-control form-control-sm" placeholder="your.email@example.com" required />
                </div>
                <div class="form-group">
                    <textarea name="Message" class="form-control form-control-sm" rows="3" placeholder="Write your reply..." required></textarea>
                </div>
                <input type="hidden" name="BlogPostId" value="@ViewContext.RouteData.Values["id"]" />
                <button type="submit" class="btn btn-comment btn-sm">Post Reply</button>
            </form>
        </div>

        <!-- show replies if any - recursive partial view for nested comments -->
        @if (Model.Replies != null && Model.Replies.Any())
        {
            <div style="margin-left: 40px; margin-top: 10px;">
                @foreach (var reply in Model.Replies)
                {
                    @Html.Partial("_Comment", reply)
                }
            </div>
        }
    </div>
</div>